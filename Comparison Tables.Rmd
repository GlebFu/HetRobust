---
title: "Comparison Tables"
author: "Gleb Furman"
date: "November 3, 2015"
output: html_document
---

```{r, cache = F, echo = F, warning = F, results = "hide", message = F}
library(plyr)
library(dplyr)
library(ggplot2)
library(reshape2)
library(moments)
library(tidyr)
library(htmlTable)

rm(list = ls())

results <- read.csv("20150929.csv")

results <- select(results, n, B, Estruct, Edist, HC:p10)
levels(results$B) <- c("Model 2", "Model 1")
results$test <- factor(results$test, levels = c("naive", "edgeKC", "saddle_V1", "saddle_V2", "Satt"))

levels(results$test) <- c("N", "E", "S_M", "S_E", "S")
levels(results$HC) <- c("0", "1", "2", "3", "4", "4m", "5")

```

```{r, cache = T, echo = F, warning = F, results = "asis", fig.width = 15, fig.height = 15}
PIR <- filter(results, criterion == "size", n == "25") %>%
  mutate(method = paste(test, HC, sep = "_")) %>%
  select(n:Edist, coef, method, p05)

PIR <- merge(PIR, spread(PIR, key = method, value = p05))

compare <- function(y, x, nom = .05427) {
  vals <- cbind(y, x)
  
  vals[x == y] <- "equal"
  
  vals[(x > nom & y <= nom) | 
         (x > nom & y > nom & x > y) | 
         (x <= nom & y <= nom & x < y)] <- "y"
  
  vals[(x <= nom & y > nom) |
         (x > nom & y > nom & x < y) |
         (x <= nom & y <= nom & x > y)] <- "x"
 
  return(vals[,1])
}

PIR[,8:42] <- sapply(select(PIR, E_0:S_M_5), compare, x = PIR$p05)


gather(PIR, key = "vs", value = "winPercent", E_0:S_M_5) %>%
  group_by(method, vs) %>%
  summarize(winPercent = round(mean(winPercent == "x")*100, 2)) %>%
  spread(key = vs, value = winPercent) -> Size_25_p05

htmlTable(Size_25_p05)
write.csv(Size_25_p05, file = "Size_25_p05.csv")

PIR$condper <- apply(PIR[,9:42], 1, function(x) mean(x == "x"))

select(PIR, n:p05, condper) %>%
  group_by(method) %>%
  summarize(condper = round(mean(condper)*100, 2)) %>%
  as.data.frame()
```

```{r, cache = T, echo = F, warning = F, results = "asis", fig.width = 15, fig.height = 15}

test2 <- as.data.frame(PIR[,c(1,12)])
test2 <- test2[test2[,2] == 3.81,]


test3 <- filter(PIR, method == "naive_HC3") %>%
  select(n:p05, eval(parse(text = paste(test2[,1], collapse = ", "))))

test4 <- cbind(test3, sapply(select(test3, edgeKC_HC3:Satt_HC4m), compare, x = test3$p05))
test4 <- test4[order(test4[,19]),]
test4 <- test4[,1:19]


```